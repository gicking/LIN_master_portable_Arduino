# based on https://github.com/arduino-libraries/ArduinoBLE/blob/master/.github/workflows/compile-examples.yml
name: Build for SAMD

# set workflow trigger
on:

  # Trigger workflow on every push and pull request
  push:
  pull_request:
  
  # Also run periodically to catch breakage caused by changes to external resources (libraries, platforms).
  schedule:
    # Minute, Hour, Day of Month, Month, Day of Week (UTC timezone)
    #- cron: '20 21 */7 * *'
    - cron: '0 1 2 * *'


# configure workflow jobs
jobs:

  # Build for SAMD
  build-for-samd:
    
    # setup OS
    runs-on: ubuntu-latest

    # setup environment
    env:
      SKETCHES_REPORTS_PATH: sketches-reports
    
    # test strategy & tested boards
    strategy:
      fail-fast: false
      matrix:
        board:
          - fqbn: arduino:sam:arduino_due_x_dbg       # Arduino Due (Programming Port)
            artifact-name-suffix: arduino_sam_arduino_due_x_dbg

    # integration test steps
    steps:

      # check-out this repository
      - uses: actions/checkout@v4.2.2

      # build Arduino examples
      - uses: arduino/compile-sketches@v1.1.2
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}   # required for private repos
          fqbn: ${{ matrix.board.fqbn }}
          libraries: |
            - source-path: ./
          sketch-paths: |
            - examples/LIN_master_HWSerial_Blk
          cli-compile-flags: |
            - --verbose
          extra-flag: |
            -DLIN_MASTER_DEBUG_SERIAL=Serial
